% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Go_MaAsLin2_Heatmap.R
\name{Go_Maaslin2_heatmap}
\alias{Go_Maaslin2_heatmap}
\title{Go_Maaslin2_heatmap}
\usage{
Go_Maaslin2_heatmap(
  df,
  project = "Proj",
  p_cut = NULL,
  q_cut = NULL,
  orders = NULL,
  name = NULL,
  height = 3,
  width = 4,
  cluster_rows = TRUE,
  title = NULL
)
}
\arguments{
\item{df}{A MaAsLin2 result table (typically \code{all_results.tsv}) containing
at least: \code{feature}, \code{metadata}, \code{value} (timepoint),
\code{coef}, \code{pval}, \code{qval}.}

\item{project}{Character. Project name used for directory creation and
output file prefix (e.g., \code{"IBD"}, \code{"CM"}).}

\item{p_cut}{Numeric or NULL. Optional p-value cutoff.
If provided, features with \emph{any} timepoint p-value â‰¤ \code{p_cut}
are retained.
If \code{NULL}, p-value filtering is disabled.}

\item{q_cut}{Numeric or NULL. Optional q-value cutoff.
Logic is identical to \code{p_cut}.
If both \code{p_cut} and \code{q_cut} are supplied, filtering is applied
to \strong{either} (logical OR).}

\item{orders}{Optional vector specifying the desired order of timepoints.
If NULL, timepoints are sorted numerically.}

\item{name}{Optional character used as a user-defined prefix for output
PDF naming (e.g., \code{"AtoM"}, \code{"MtoA"}, \code{"Common"}).
If \code{NULL}, no name prefix is added.}

\item{height}{Numeric. Height of the saved PDF plot (in inches).}

\item{width}{Numeric. Width of the saved PDF plot.}

\item{cluster_rows}{Logical. If TRUE (default), features are hierarchically
clustered using their longitudinal coefficient profiles.}

\item{title}{Optional title for the heatmap.
If NULL, title is auto-generated based on p/q thresholds.}
}
\value{
Invisibly returns the ggplot object used for the heatmap.
A PDF file is saved as a side effect.
}
\description{
Generate a longitudinal heatmap for MaAsLin2 regression coefficients
across Timepoints, highlighting statistically meaningful patterns
(p-value or q-value thresholds) with optional row clustering.
}
\details{
This function takes a MaAsLin2 \code{all_results.tsv} table, extracts
only the Timepoint-associated coefficients, filters features based on
user-defined significance thresholds (\code{p_cut}, \code{q_cut}), expands them
across all timepoints, and visualizes the effect-size trajectories
using a clean ggplot2 heatmap.

Significant tiles are annotated using a significance symbol system:
\itemize{
\item \code{"**"} for p/q < 0.01
\item \code{"*"}  for p/q < 0.05
\item \code{"."}  for p/q < 0.08
\item \code{""}   otherwise
}

Timepoint coefficients are plotted by \code{coef} (log-effect size), while
significance is reflected only by tile annotation (text), not by color.

When \code{cluster_rows = TRUE}, features are hierarchically clustered
based on Euclidean distance over their coefficient trajectories,
grouping together bacteria with similar longitudinal patterns.

Output is automatically saved under:
\preformatted{
  <project>_<YYMMDD>/pdf/MaAsLin2_Heatmap_<name>_<project>_<pX>_<qY>.pdf
}

The function performs the following steps:
\enumerate{
\item Subsets rows where \code{metadata == "Timepoint"}.
\item Applies p- or q-value significance filtering (feature-level).
\item Expands filtered features across \emph{all} timepoints
(missing combinations are filled with coef=0).
\item Optionally clusters features by effect-size similarity.
\item Annotates tiles with significance markers.
\item Generates a ggplot2 heatmap (\code{geom_tile + geom_text}).
\item Saves the figure to a dated project directory.
}
}
\examples{
\dontrun{
df <- read.table("all_results.tsv", sep="\t", header=TRUE)

Go_Maaslin2_heatmap(df,
    project = "CM",
    p_cut   = 0.1,
    q_cut   = NULL,
    orders  = c(14,30,44,58,74,88),
    name    = "AtoM",
    height  = 4,
    width   = 5
)
}

}
