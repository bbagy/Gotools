#' @param kingdom One of "Bacteria", "Virus", "Fungi"
#'
#' @return A phyloseq object
#'
#' @author Heekuk Park <hp2523@cumc.columbia.edu>
#' @date 2025-11-01
#'
#' @export
Go_kraken2Extraction <- function(kraken2, bracken=NULL, kingdom=c("Bacteria","Virus","Fungi")) {
library(dplyr)
library(phyloseq)
kingdom <- match.arg(kingdom)
# ----------------------------
# 1. Kraken2 MPA load
# ----------------------------
kraken <- read.delim(kraken2, sep="\t", header=TRUE, check.names=FALSE)
kraken$ID <- as.character(kraken$ID)
# ==========================================================
#  CASE 1: VIRUS  (NO Bracken)
# ==========================================================
if (kingdom == "Virus") {
# Only keep viral rows
virus <- kraken %>% filter(grepl("^d__Viruses", ID))
virus$ID <- as.character(virus$ID)
# Keep ONLY species-level rows
virus <- virus[grepl("s__", virus$ID), ]
# --------------------
# Viral taxonomy parser
# --------------------
parse_viral_tax <- function(x) {
parts <- unlist(strsplit(x, "\\|"))
get <- function(prefix) {
m <- grep(paste0("^", prefix), parts, value=TRUE)
if (length(m)==0) return(NA)
return(sub("^[a-z]__+", "", m))
}
return(c(
Phylum = get("p__"),
Class  = get("c__"),
Order  = get("o__"),
Family = get("f__"),
Genus  = get("g__"),
Species= get("s__")
))
}
taxonomy <- as.data.frame(do.call(rbind, lapply(virus$ID, parse_viral_tax)))
# Replace NA â†’ "Unknown"
taxonomy[is.na(taxonomy)] <- "Unknown"
taxonomy$Rank1 <- "Viruses"
taxonomy <- taxonomy[, c("Rank1","Phylum","Class","Order","Family","Genus","Species")]
rownames(taxonomy) <- virus$ID
# OTU matrix
otu_mat <- as.matrix(virus[, setdiff(colnames(virus),"ID")])
rownames(otu_mat) <- virus$ID
otu <- otu_table(otu_mat, taxa_are_rows=TRUE)
tax <- tax_table(as.matrix(taxonomy))
dim(tax)
return(phyloseq(otu,tax))
}
# ==========================================================
#  CASE 2: BACTERIA  (Bracken REQUIRED)
# ==========================================================
if (kingdom == "Bacteria") {
if (is.null(bracken)) stop("Bracken file required for Bacteria.")
br <- read.delim(bracken, sep="\t", header=TRUE, check.names=FALSE)
# Extract species id
kraken$species_id <- sub(".*\\|s__", "s__", kraken$ID)
kraken$species_id[!grepl("^s__", kraken$species_id)] <- NA
parse_taxonomy <- function(x) {
parts <- unlist(strsplit(x,"\\|"))
get <- function(prefix){
m <- grep(paste0("^",prefix), parts, value=TRUE)
if (length(m)==0) return(NA)
return(sub("^[a-z]__+","",m))
}
return(c(
phylum  = get("p__"),
class   = get("c__"),
order   = get("o__"),
family  = get("f__"),
genus   = get("g__"),
species = get("s__")
))
}
taxonomy <- as.data.frame(
do.call(rbind, lapply(kraken$ID, parse_taxonomy)),
stringsAsFactors = FALSE
)
taxonomy_df <- cbind(species_id = kraken$species_id, taxonomy)
taxonomy_df$species_id <- gsub(" ","_", taxonomy_df$species_id)
merged <- merge(br, taxonomy_df, by.x="ID", by.y="species_id", all.x=TRUE)
ranks <- c("phylum","class","order","family","genus","species")
colnames(merged) <- sapply(colnames(merged), function(x){
if (x %in% ranks) paste0(toupper(substr(x,1,1)), substr(x,2,nchar(x)))
else x
})
merged[, ranks] <- lapply(merged[, ranks], function(x) ifelse(is.na(x),"Unknown",x))
otu_cols <- setdiff(colnames(merged), c("ID","Phylum","Class","Order","Family","Genus","Species"))
otu_mat <- as.matrix(merged[, otu_cols])
rownames(otu_mat) <- merged$ID
taxonomy <- merged[, c("Phylum","Class","Order","Family","Genus","Species")]
taxonomy$Rank1 <- "Bacteria"
taxonomy <- taxonomy[, c("Rank1","Phylum","Class","Order","Family","Genus","Species")]
rownames(taxonomy) <- rownames(otu_mat)
otu <- otu_table(otu_mat, taxa_are_rows=TRUE)
tax <- tax_table(as.matrix(taxonomy))
return(phyloseq(otu,tax))
}
# ==========================================================
#  CASE 3: FUNGI (NO Bracken)
# ==========================================================
if (kingdom == "Fungi") {
fungi <- kraken %>% filter(grepl("k__Fungi", ID))
fungi <- fungi[grepl("s__", fungi$ID), ]  # species only
parse_fun_tax <- function(x){
parts <- unlist(strsplit(x,"\\|"))
get <- function(prefix){
m <- grep(paste0("^",prefix), parts, value=TRUE)
if (length(m)==0) return(NA)
return(sub("^[a-z]__+","",m))
}
return(c(
Phylum = get("p__"),
Class  = get("c__"),
Order  = get("o__"),
Family = get("f__"),
Genus  = get("g__"),
Species= get("s__")
))
}
taxonomy <- as.data.frame(do.call(rbind, lapply(fungi$ID, parse_fun_tax)))
taxonomy[is.na(taxonomy)] <- "Unknown"
taxonomy$Rank1 <- "Fungi"
taxonomy <- taxonomy[, c("Rank1","Phylum","Class","Order","Family","Genus","Species")]
rownames(taxonomy) <- fungi$ID
otu_mat <- as.matrix(fungi[, setdiff(colnames(fungi),"ID")])
rownames(otu_mat) <- fungi$ID
otu <- otu_table(otu_mat, taxa_are_rows=TRUE)
tax <- tax_table(as.matrix(taxonomy))
return(phyloseq(otu,tax))
}
}
ps_v <- Go_kraken2Extraction(
kraken2="1_out/20251111_kraken2_mpa.txt",
kingdom="Virus"
);ps_v
ps_fun <- Go_kraken2Extraction(
kraken2="1_out/20251111_kraken2_mpa.txt",
kingdom="Fungi"
);ps_fun
# Go_emptyMap(ps.bracken, project)
sampledata <- read.csv("3_map/251111.Urine_MG.mapping.csv",row.names=1,check.names=FALSE)
ps1 <- merge_phyloseq(ps_fun,sample_data(data.frame(sampledata)));ps1
View(otu)
ps_fun <- Go_kraken2Extraction(
kraken2="1_out/20251111_kraken2_mpa.txt",
kingdom="Fungi"
);ps_fun
# Go_emptyMap(ps.bracken, project)
sampledata <- read.csv("3_map/251113.Urine_MG.mapping_virus.csv",row.names=1,check.names=FALSE)
ps1 <- merge_phyloseq(ps_fun,sample_data(data.frame(sampledata)));ps1
ps1 <- merge_phyloseq(ps_v,sample_data(data.frame(sampledata)));ps1
# control spikin
exclude_species  <-  c("Allobacillus halotolerans", "Imtechella halotolerans")
taxa_to_keep <- taxa_names(ps1)[!(tax_table(ps1)[, "Species"] %in% exclude_species)]
ps1.prune <- prune_taxa(taxa_to_keep, ps1);ps1.prune
ps2 <- Go_filter(ps1.prune,cutoff = 0.00001) #  0.00001
ps1.prune <- prune_taxa(taxa_to_keep, ps1);ps1.prune
ps2 <- ps1.prune
unique(sampledata$Groups)
orders <- c("MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
###=== alpha diversity
adiv <- Go_adiv(psIN = ps2,  project = project, alpha_metrics = c("Chao1","Shannon"));colnames(adiv)
boxcol <- Go_myCols(piratepal = "info");boxcol
boxcol <- c("#E7695DFF", "#6B8993FF", "#95CE8AFF")
unique(sampledata$ADTKD)
orders <- c("MUC1", "Healthy Control","Male", "Female")
Go_boxplot(df=adiv, project = project, title = NULL, xangle = 90,  mycols = boxcol,combination = NULL,
cate.vars = c("ADTKD"), outcomes = c("Chao1","Shannon"), addnumber = F, paired = NULL,
orders = orders, star= F, facet = NULL, name = "(ADTKD)", cutoff = 0.3,
height = 3.2, width = 3, plotCols=2, plotRows=1, standardsize = F)
Go_boxplot(df=adiv, project = project, title = NULL, xangle = 90,  mycols = boxcol,combination = NULL,
cate.vars = c("ADTKD"), outcomes = c("Chao1","Shannon"), addnumber = F, paired = NULL,
orders = orders, star= F, facet = "Gender", name = "(ADTKD by Gender)", cutoff = 0.3,
height = 3.2, width = 3, plotCols=2, plotRows=1, standardsize = T)
###=== beta diversity
boxcol <- c("#E7695DFF", "#6B8993FF", "#95CE8AFF")
orders <- c("MUC1", "Healthy Control","Male", "Female")
Go_bdivPM(
psIN = ps2, project = project, mycols = boxcol,
cate.vars = c("ADTKD"), orders = orders, cate.conf = NULL,
combination = NULL, distance_metrics = c("bray","jsd","jaccard"),addnumber = F,
plot = c("PCoA"), shapes = "Gender", ID = NULL, ellipse = TRUE, strata_var = NULL,
facet = NULL, name = "(ADTKD)", height = 4, width = 4
)
Go_bdivPM(
psIN = ps2, project = project, mycols = boxcol,
cate.vars = c("ADTKD"), orders = orders, cate.conf = NULL,
combination = NULL, distance_metrics = c("bray","jsd","jaccard"),addnumber = F,
plot = c("PCoA"), shapes = NULL, ID = NULL, ellipse = TRUE, strata_var = NULL,
facet = "Gender", name = "(ADTKD by Gender)", height = 4, width = 4
)
Go_boxplot(df=adiv, project = project, title = NULL, xangle = 90,  mycols = boxcol,combination = NULL,
cate.vars = c("ADTKD"), outcomes = c("Chao1","Shannon"), addnumber = F, paired = NULL,
orders = orders, star= F, facet = "Gender", name = "(ADTKD by Gender)", cutoff = 0.3,
height = 3.2, width = 3, plotCols=2, plotRows=1, standardsize = T)
orders <- c("MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
ps2 <- ps1.prune
ps2
unique(sampledata$Groups)
orders <- c("MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = NULL, legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
# Go_emptyMap(ps.bracken, project)
sampledata <- read.csv("3_map/251113.Urine_MG.mapping_virus.csv",row.names=1,check.names=FALSE)
View(sampledata)
unique(sampledata$StudyID)
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
orders
orders <- c(unique(sampledata$StudyID), "MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
ps2 <- Go_filter(ps1.prune,cutoff = 0.000000001)
ps2 <- Go_filter(ps1.prune,cutoff = 0.0000000000001)
ps2 <- ps1.prune
ps_fun <- Go_kraken2Extraction(
kraken2="1_out/20251111_kraken2_mpa.txt",
kingdom="Fungi"
);ps_fun
ps1 <- merge_phyloseq(ps_fun,sample_data(data.frame(sampledata)));ps1
# control spikin
exclude_species  <-  c("Allobacillus halotolerans", "Imtechella halotolerans")
taxa_to_keep <- taxa_names(ps1)[!(tax_table(ps1)[, "Species"] %in% exclude_species)]
ps1.prune <- prune_taxa(taxa_to_keep, ps1);ps1.prune
ps2 <- Go_filter(ps1.prune,cutoff = 0.00001) #  0.00001
unique(sampledata$StudyID)
ps2 <- ps1.prune
unique(sampledata$StudyID)
orders <- c(unique(sampledata$StudyID), "MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = NULL, legend = "bottom",
orders = orders,  x_label = NULL, mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = T, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
# Go_emptyMap(ps.bracken, project)
sampledata <- read.csv("3_map/251113.Urine_MG.mapping_virus.csv",row.names=1,check.names=FALSE)
ps1 <- merge_phyloseq(ps_v,sample_data(data.frame(sampledata)));ps1
# control spikin
exclude_species  <-  c("Allobacillus halotolerans", "Imtechella halotolerans")
taxa_to_keep <- taxa_names(ps1)[!(tax_table(ps1)[, "Species"] %in% exclude_species)]
ps1.prune <- prune_taxa(taxa_to_keep, ps1);ps1.prune
ps2 <- Go_filter(ps1.prune,cutoff = 0.00001) #  0.00001
ps2 <- ps1.prune
unique(sampledata$StudyID)
orders <- c(unique(sampledata$StudyID), "MUC1", "Healthy Control","Male", "Female","MUC1_Male", "MUC1_Female","Healthy Control_Male", "Healthy Control_Female")
barplot.col <- Go_myCols(custumCols = "cols3");barplot.col
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Phylum"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Phylum)",
ncol=8, height = 5, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Class"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Class)",
ncol=8, height = 5.6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Order"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Order)",
ncol=8, height = 6, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Family"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Family)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Genus"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Genus)",
ncol=8, height = 6.35, width = 8)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = T,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species)",
ncol=8, height = 7.1, width = 8.15)
Go_barchart(psIN = ps2, project = project, cutoff = 0.005, simple = F, relative = F,
taxanames =c("Species"), cate.vars="ADTKD", facet = "Gender", legend = "bottom",
orders = orders,  x_label = "StudyID", mycols = barplot.col,
name = "(Species_Absolute)",
ncol=8, height = 7.1, width = 8.15)
# build package
setwd("~/Dropbox/04_Scripts/R_source/Gotools")
devtools::build() # generate Gotools_0.0.0.9000.tar.gz
devtools::document()
setwd("~/Dropbox/04_Scripts/R_source/Gotools")
devtools::build()
devtools::document()
devtools::document()
devtools::document()
# build package
setwd("~/Dropbox/04_Scripts/R_source/Gotools")
devtools::build() # generate Gotools_0.0.0.9000.tar.gz
devtools::document()
